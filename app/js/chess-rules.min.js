function drop(t){t.preventDefault();let e=document.getElementById(t.dataTransfer.getData("id"));if(!e?.getAttribute("side").includes(data.side))return;let r="icon"===t.target.localName?t.target.parentNode:t.target,o=new Date,i=o.toLocaleDateString("es-CO"),s=o.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),a={id:e.id,type:e.getAttribute("name"),side:data.side,turn:data.turn,date:i,time:s,pos:{initial:{id:e.parentNode.id,col:parseInt(e.getAttribute("col")),row:parseInt(e.getAttribute("row"))},final:{id:r.id,col:parseInt(r.getAttribute("col")),row:parseInt(r.getAttribute("row"))},diffs:{cols:parseInt(e.getAttribute("col"))-parseInt(r.getAttribute("col")),rows:parseInt(e.getAttribute("row"))-parseInt(r.getAttribute("row"))}}},l;r.children.length>0&&(l=r.children[0],a.captured={side:l.getAttribute("side"),points:l.getAttribute("points"),catch:!1},validateCaptured(a.captured)),validateMovement(a)&&(a.captured?.catch&&r.removeChild(l),history.push(a),addToMovementsTable(a),e.setAttribute("state","moved"),e.setAttribute("col",r.getAttribute("col")),e.setAttribute("row",r.getAttribute("row")),r.appendChild(e),changeTurn(),turnLabel.html(data.side),quantityLabel.html(data.turn))}function validateCaptured(t){return t.side!==data.side&&(t.catch=!0,"white"===data.side?(white_points+=parseInt(t.points),$("#white_points").html(white_points)):(black_points+=parseInt(t.points),$("#black_points").html(black_points)),t.catch)}function validateTrayectory(t){let e=t.pos.initial,r=t.pos.final;if(e.col===r.col){for(let o=Math.min(e.row,r.row)+1;o<Math.max(e.row,r.row);o++)if($(`#${o}${data.cols[e.col-1]}`).children().length>0)return!1}else if(e.row===r.row){for(let i=Math.min(e.col,r.col)+1;i<Math.max(e.col,r.col);i++)if($(`#${e.row}${data.cols[i-1]}`).children().length>0)return!1}if(Math.abs(e.col-r.col)===Math.abs(e.row-r.row)){let s=(r.col-e.col)/Math.abs(r.col-e.col),a=(r.row-e.row)/Math.abs(r.row-e.row);for(let l=1;l<Math.abs(e.col-r.col);l++){let c;if($(`#${e.row+l*a}${data.cols[e.col+l*s-1]}`).children().length>0)return!1}}return!0}function validateMovement(t){switch(t.type){case"king":if(Math.abs(t.pos.diffs.cols)>1||Math.abs(t.pos.diffs.rows)>1)return!1;break;case"queen":if(0!==Math.abs(t.pos.diffs.cols)&&0!==Math.abs(t.pos.diffs.rows)&&Math.abs(t.pos.diffs.cols)!==Math.abs(t.pos.diffs.rows))return!1;return validateTrayectory(t);case"tower":if(0!==Math.abs(t.pos.diffs.cols)&&0!==Math.abs(t.pos.diffs.rows))return!1;return validateTrayectory(t);case"bishop":if(Math.abs(t.pos.diffs.cols)!==Math.abs(t.pos.diffs.rows))return!1;return validateTrayectory(t);case"horse":return 1===Math.abs(t.pos.diffs.cols)&&2===Math.abs(t.pos.diffs.rows)||2===Math.abs(t.pos.diffs.cols)&&1===Math.abs(t.pos.diffs.rows);case"pawn":let e=0;switch(t.side){case"white":e=1;break;case"black":e=-1}if(e*t.pos.diffs.cols!=(t.captured?.catch?1:0)||e*t.pos.diffs.rows>(t.turn<2?2:1))return!1;break;default:return!1}return!0}