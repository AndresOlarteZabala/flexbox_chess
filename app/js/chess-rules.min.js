function drop(t){t.preventDefault();let e=document.getElementById(t.dataTransfer.getData("id"));if(!e?.getAttribute("side").includes(data.side))return;let i="icon"===t.target.localName?t.target.parentNode:t.target,o=new Date,r=o.toLocaleDateString("es-CO"),s=o.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),a={id:e.id,type:e.getAttribute("name"),side:data.side,turn:data.turn,date:r,time:s,pos:{initial:{id:e.parentNode.id,col:parseInt(e.getAttribute("col")),row:parseInt(e.getAttribute("row"))},final:{id:i.id,col:parseInt(i.getAttribute("col")),row:parseInt(i.getAttribute("row"))},diffs:{cols:parseInt(e.getAttribute("col"))-parseInt(i.getAttribute("col")),rows:parseInt(e.getAttribute("row"))-parseInt(i.getAttribute("row"))}}},l;i.children.length>0&&(l=i.children[0],a.captured={side:l.getAttribute("side"),points:l.getAttribute("points"),catch:!1},validateCaptured(a.captured)),validateMovement(a)&&(a.captured?.catch&&i.removeChild(l),history.push(a),addToMovementsTable(a),e.setAttribute("state","moved"),e.setAttribute("col",i.getAttribute("col")),e.setAttribute("row",i.getAttribute("row")),i.appendChild(e),changeTurn(),turnLabel.html(data.side),quantityLabel.html(data.turn),startClock(data),saveGame(data))}function validateCaptured(t){return t.side!==data.side&&(t.catch=!0,"white"===data.side?(white_points+=parseInt(t.points),$("#white_points").html(white_points)):(black_points+=parseInt(t.points),$("#black_points").html(black_points)),t.catch)}function validateTrayectory(t){let e=t.pos.initial,i=t.pos.final;if(e.col===i.col){for(let o=Math.min(e.row,i.row)+1;o<Math.max(e.row,i.row);o++)if($(`#${o}${data.cols[e.col-1]}`).children().length>0)return!1}else if(e.row===i.row){for(let r=Math.min(e.col,i.col)+1;r<Math.max(e.col,i.col);r++)if($(`#${e.row}${data.cols[r-1]}`).children().length>0)return!1}if(Math.abs(e.col-i.col)===Math.abs(e.row-i.row)){let s=(i.col-e.col)/Math.abs(i.col-e.col),a=(i.row-e.row)/Math.abs(i.row-e.row);for(let l=1;l<Math.abs(e.col-i.col);l++){let c;if($(`#${e.row+l*a}${data.cols[e.col+l*s-1]}`).children().length>0)return!1}}return!0}function validateMovement(t){switch(t.type){case"king":if(Math.abs(t.pos.diffs.cols)>1||Math.abs(t.pos.diffs.rows)>1)return!1;break;case"queen":if(0!==Math.abs(t.pos.diffs.cols)&&0!==Math.abs(t.pos.diffs.rows)&&Math.abs(t.pos.diffs.cols)!==Math.abs(t.pos.diffs.rows))return!1;return validateTrayectory(t);case"tower":if(0!==Math.abs(t.pos.diffs.cols)&&0!==Math.abs(t.pos.diffs.rows))return!1;return validateTrayectory(t);case"bishop":if(Math.abs(t.pos.diffs.cols)!==Math.abs(t.pos.diffs.rows))return!1;return validateTrayectory(t);case"horse":return 1===Math.abs(t.pos.diffs.cols)&&2===Math.abs(t.pos.diffs.rows)||2===Math.abs(t.pos.diffs.cols)&&1===Math.abs(t.pos.diffs.rows);case"pawn":let e=0;switch(t.side){case"white":e=1;break;case"black":e=-1}if(e*t.pos.diffs.cols!=(t.captured?.catch?1:0)||e*t.pos.diffs.rows>(t.turn<2?2:1))return!1;break;default:return!1}return!0}let whiteTime=0,blackTime=0,intervalId;function startClock(t){intervalId&&clearInterval(intervalId),intervalId=setInterval(()=>updateClock(t),1e3)}function stopClock(){clearInterval(intervalId)}function updateClock(t){"white"===t.side&&whiteTime++,"black"===t.side&&blackTime++,t.whiteTime=whiteTime,t.blackTime=blackTime,updateClockDisplay()}function updateClockDisplay(){let t=document.getElementById("white-clock"),e=document.getElementById("black-clock");t.textContent=formatTime(whiteTime),e.textContent=formatTime(blackTime)}function formatTime(t){return`${padZero(Math.floor(t/3600))}:${padZero(Math.floor(t%3600/60))}:${padZero(t%60)}`}function padZero(t){return t<10?`0${t}`:t}